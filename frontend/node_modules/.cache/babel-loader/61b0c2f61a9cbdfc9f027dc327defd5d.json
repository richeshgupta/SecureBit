{"ast":null,"code":"import Axios from \"axios\";\nimport { logout, tokenName } from \"./Pages/authController\";\nimport { ME_URL, REFERESH_URL } from \"./urls\";\nexport const LastUserChat = \"lastUserChat\";\nexport const axiosHandler = ({\n  method = \"\",\n  url = \"\",\n  token = null,\n  data = {},\n  extra = null\n}) => {\n  let methodType = method.toUpperCase();\n\n  if ([\"GET\", \"POST\", \"PATCH\", \"PUT\", \"DELETE\"].includes(methodType) || {}.toString(data) !== \"[object Object]\") {\n    let axiosProps = {\n      method: methodType,\n      url,\n      data\n    };\n\n    if (token) {\n      axiosProps.headers = {\n        Authorization: `Bearer ${token}`\n      };\n    }\n\n    if (extra) {\n      axiosProps.headers = { ...axiosProps.headers,\n        ...extra\n      };\n    }\n\n    return Axios(axiosProps);\n  } else {\n    alert(`method ${methodType} is not accepted or data is not an object`);\n  }\n};\nexport const errorHandler = (err, defaulted = false) => {\n  if (defaulted) {\n    return \"Ops!, an error occurred.\";\n  }\n\n  let messageString = \"\";\n\n  if (!err.response) {\n    messageString += \"Network error! check your network and try again\";\n  } else {\n    let data = err.response.data.results;\n\n    if (!err.response.data.results) {\n      data = err.response.data;\n    }\n\n    messageString = loopObj(data);\n  }\n\n  return messageString.replace(/{|}|'|\\[|\\]/g, \"\");\n};\n\nconst loopObj = obj => {\n  let agg = \"\";\n\n  for (let key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      agg += `<div>${key}: ${typeof obj[key] === \"object\" ? loopObj(obj[key]) : obj[key]}</div>`;\n    }\n  }\n\n  return agg;\n};\n\nexport const getToken = async props => {\n  let token = localStorage.getItem(tokenName);\n  if (!token) logout(props);\n  token = JSON.parse(token);\n  const userProfile = await axiosHandler({\n    method: \"get\",\n    url: ME_URL,\n    token: token.access\n  }).catch(e => null);\n\n  if (userProfile) {\n    return token.access;\n  } else {\n    const getNewAccess = await axiosHandler({\n      method: \"post\",\n      url: REFERESH_URL,\n      data: {\n        refresh: token.refresh\n      }\n    }).catch(e => null);\n\n    if (getNewAccess) {\n      localStorage.setItem(tokenName, JSON.stringify(getNewAccess.data));\n      return getNewAccess.data.access;\n    } else {\n      logout(props);\n    }\n  }\n};","map":{"version":3,"sources":["/home/richeshgupta/Desktop/SecureBit/frontend/src/helper.js"],"names":["Axios","logout","tokenName","ME_URL","REFERESH_URL","LastUserChat","axiosHandler","method","url","token","data","extra","methodType","toUpperCase","includes","toString","axiosProps","headers","Authorization","alert","errorHandler","err","defaulted","messageString","response","results","loopObj","replace","obj","agg","key","hasOwnProperty","getToken","props","localStorage","getItem","JSON","parse","userProfile","access","catch","e","getNewAccess","refresh","setItem","stringify"],"mappings":"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","sourcesContent":["import Axios from \"axios\";\nimport { logout, tokenName } from \"./Pages/authController\";\nimport { ME_URL, REFERESH_URL } from \"./urls\";\n\nexport const LastUserChat = \"lastUserChat\";\n\nexport const axiosHandler = ({\n  method = \"\",\n  url = \"\",\n  token = null,\n  data = {},\n  extra = null,\n}) => {\n  let methodType = method.toUpperCase();\n  if (\n    [\"GET\", \"POST\", \"PATCH\", \"PUT\", \"DELETE\"].includes(methodType) ||\n    {}.toString(data) !== \"[object Object]\"\n  ) {\n    let axiosProps = { method: methodType, url, data };\n\n    if (token) {\n      axiosProps.headers = { Authorization: `Bearer ${token}` };\n    }\n    if (extra) {\n      axiosProps.headers = { ...axiosProps.headers, ...extra };\n    }\n    return Axios(axiosProps);\n  } else {\n    alert(`method ${methodType} is not accepted or data is not an object`);\n  }\n};\n\nexport const errorHandler = (err, defaulted = false) => {\n  if (defaulted) {\n    return \"Ops!, an error occurred.\";\n  }\n\n  let messageString = \"\";\n  if (!err.response) {\n    messageString += \"Network error! check your network and try again\";\n  } else {\n    let data = err.response.data.results;\n    if (!err.response.data.results) {\n      data = err.response.data;\n    }\n    messageString = loopObj(data);\n  }\n  return messageString.replace(/{|}|'|\\[|\\]/g, \"\");\n};\n\nconst loopObj = (obj) => {\n  let agg = \"\";\n  for (let key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      agg += `<div>${key}: ${\n        typeof obj[key] === \"object\" ? loopObj(obj[key]) : obj[key]\n      }</div>`;\n    }\n  }\n  return agg;\n};\n\nexport const getToken = async (props) => {\n  let token = localStorage.getItem(tokenName);\n  if (!token) logout(props);\n  token = JSON.parse(token);\n  const userProfile = await axiosHandler({\n    method: \"get\",\n    url: ME_URL,\n    token: token.access,\n  }).catch((e) => null);\n  if (userProfile) {\n    return token.access;\n  } else {\n    const getNewAccess = await axiosHandler({\n      method: \"post\",\n      url: REFERESH_URL,\n      data: {\n        refresh: token.refresh,\n      },\n    }).catch((e) => null);\n    if (getNewAccess) {\n      localStorage.setItem(tokenName, JSON.stringify(getNewAccess.data));\n      return getNewAccess.data.access;\n    } else {\n      logout(props);\n    }\n  }\n};\n"]},"metadata":{},"sourceType":"module"}