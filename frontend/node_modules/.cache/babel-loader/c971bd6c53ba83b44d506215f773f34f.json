{"ast":null,"code":"var _jsxFileName = \"/home/richeshgupta/Desktop/SecureBit/frontend/src/Pages/authController.js\";\nimport React, { useEffect, useState, useContext } from \"react\";\nimport Loader from \"../components/loader\";\nimport { axiosHandler, getToken, LastUserChat } from \"../helper\";\nimport { REFERESH_URL, ME_URL, LOGOUT_URL } from \"../urls\";\nimport { store } from \"../stateManagement/store\";\nimport { userDetailAction } from \"../stateManagement/actions\";\nexport const tokenName = \"tokenName\";\nexport const logout = props => {\n  if (localStorage.getItem(tokenName)) {\n    axiosHandler({\n      method: \"get\",\n      url: LOGOUT_URL,\n      token: getToken()\n    });\n  }\n\n  localStorage.removeItem(tokenName);\n  localStorage.removeItem(LastUserChat);\n  window.location.href = \"/login\";\n};\nexport const checkAuthState = async (setChecking, dispatch, props) => {\n  let token = localStorage.getItem(tokenName);\n\n  if (!token) {\n    logout(props);\n    return;\n  }\n\n  token = JSON.parse(token);\n  const userProfile = await axiosHandler({\n    method: \"get\",\n    url: ME_URL,\n    token: token.access\n  }).catch(e => null);\n\n  if (userProfile) {\n    setChecking(false);\n    dispatch({\n      type: userDetailAction,\n      payload: userProfile.data\n    });\n  } else {\n    const getNewAccess = await axiosHandler({\n      method: \"post\",\n      url: REFERESH_URL,\n      data: {\n        refresh: token.refresh\n      }\n    }).catch(e => null);\n\n    if (getNewAccess) {\n      localStorage.setItem(tokenName, JSON.stringify(getNewAccess.data));\n      checkAuthState(setChecking, dispatch, props);\n    } else {\n      logout(props);\n    }\n  }\n};\n\nconst AuthController = props => {\n  const [checking, setChecking] = useState(true);\n  const {\n    dispatch\n  } = useContext(store);\n  useEffect(() => {\n    checkAuthState(setChecking, dispatch, props);\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"authContainer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 5\n    }\n  }, checking ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"centerAll\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Loader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 11\n    }\n  })) : props.children);\n};\n\nexport default AuthController;","map":{"version":3,"sources":["/home/richeshgupta/Desktop/SecureBit/frontend/src/Pages/authController.js"],"names":["React","useEffect","useState","useContext","Loader","axiosHandler","getToken","LastUserChat","REFERESH_URL","ME_URL","LOGOUT_URL","store","userDetailAction","tokenName","logout","props","localStorage","getItem","method","url","token","removeItem","window","location","href","checkAuthState","setChecking","dispatch","JSON","parse","userProfile","access","catch","e","type","payload","data","getNewAccess","refresh","setItem","stringify","AuthController","checking","children"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useContext } from \"react\";\nimport Loader from \"../components/loader\";\nimport { axiosHandler, getToken, LastUserChat } from \"../helper\";\nimport { REFERESH_URL, ME_URL, LOGOUT_URL } from \"../urls\";\nimport { store } from \"../stateManagement/store\";\nimport { userDetailAction } from \"../stateManagement/actions\";\n\nexport const tokenName = \"tokenName\";\n\nexport const logout = (props) => {\n  if (localStorage.getItem(tokenName)) {\n    axiosHandler({\n      method: \"get\",\n      url: LOGOUT_URL,\n      token: getToken(),\n    });\n  }\n  localStorage.removeItem(tokenName);\n  localStorage.removeItem(LastUserChat);\n  window.location.href = \"/login\";\n};\n\nexport const checkAuthState = async (setChecking, dispatch, props) => {\n  let token = localStorage.getItem(tokenName);\n  if (!token) {\n    logout(props);\n    return;\n  }\n  token = JSON.parse(token);\n  const userProfile = await axiosHandler({\n    method: \"get\",\n    url: ME_URL,\n    token: token.access,\n  }).catch((e) => null);\n  if (userProfile) {\n    setChecking(false);\n    dispatch({ type: userDetailAction, payload: userProfile.data });\n  } else {\n    const getNewAccess = await axiosHandler({\n      method: \"post\",\n      url: REFERESH_URL,\n      data: {\n        refresh: token.refresh,\n      },\n    }).catch((e) => null);\n    if (getNewAccess) {\n      localStorage.setItem(tokenName, JSON.stringify(getNewAccess.data));\n      checkAuthState(setChecking, dispatch, props);\n    } else {\n      logout(props);\n    }\n  }\n};\n\nconst AuthController = (props) => {\n  const [checking, setChecking] = useState(true);\n\n  const { dispatch } = useContext(store);\n\n  useEffect(() => {\n    checkAuthState(setChecking, dispatch, props);\n  }, []);\n\n  return (\n    <div className=\"authContainer\">\n      {checking ? (\n        <div className=\"centerAll\">\n          <Loader />\n        </div>\n      ) : (\n        props.children\n      )}\n    </div>\n  );\n};\n\nexport default AuthController;\n"]},"metadata":{},"sourceType":"module"}