{"ast":null,"code":"var _jsxFileName = \"/home/richeshgupta/Desktop/SecureBit/frontend/src/Pages/usersList.js\";\nimport React, { useState, useEffect, useContext } from \"react\";\nimport searchImg from \"../assets/search.png\";\nimport Loader from \"../components/loader\";\nimport { axiosHandler, getToken, LastUserChat } from \"../helper\";\nimport { activeChatUserAction, triggerRefreshUserListAction } from \"../stateManagement/actions\";\nimport { store } from \"../stateManagement/store\";\nimport { PROFILE_URL } from \"../urls\";\nimport { UserMain } from \"./homeComponents\";\nlet goneNext = false;\n\nfunction UsersList() {\n  const [users, setUsers] = useState([]);\n  const [fetching, setFetching] = useState(true);\n  const [nextPage, setNextPage] = useState(1);\n  const [canGoNext, setCanGoNext] = useState(false);\n  const [search, setSearch] = useState(\"\");\n  const {\n    state: {\n      triggerRefreshUserList\n    },\n    dispatch\n  } = useContext(store);\n  useEffect(() => {\n    getUserList();\n  }, [search]);\n  useEffect(() => {\n    if (triggerRefreshUserList) {\n      getUserList();\n      dispatch({\n        type: triggerRefreshUserListAction,\n        payload: false\n      });\n    }\n  }, [triggerRefreshUserList]);\n\n  const getUserList = async (append = false) => {\n    let extra = \"\";\n\n    if (search !== \"\") {\n      extra += `&keyword=${search}`;\n    }\n\n    setCanGoNext(false);\n\n    const _token = await getToken();\n\n    const _users = await axiosHandler({\n      method: \"get\",\n      url: PROFILE_URL + `?page=${nextPage}${extra}`,\n      token: _token\n    }).catch(e => null);\n\n    if (_users) {\n      if (_users.data.next) {\n        setNextPage(nextPage + 1);\n        setCanGoNext(true);\n      }\n\n      if (append) {\n        setUsers([...users, ..._users.data.results]);\n        goneNext = false;\n      } else {\n        setUsers(_users.data.results);\n      }\n\n      setFetching(false);\n    }\n\n    checkLastChat(_users.data.results);\n  };\n\n  const checkLastChat = users => {\n    let lastUserChat = localStorage.getItem(LastUserChat);\n\n    if (lastUserChat) {\n      lastUserChat = JSON.parse(lastUserChat);\n\n      if (users.filter(item => item.id === lastUserChat.id).length) {\n        setActiveUser(lastUserChat);\n      }\n    }\n  };\n\n  const setActiveUser = user_data => {\n    localStorage.setItem(LastUserChat, JSON.stringify(user_data));\n    dispatch({\n      type: activeChatUserAction,\n      payload: user_data\n    });\n  };\n\n  const handleScroll = e => {\n    if (e.target.scrollTop >= e.target.scrollHeight - (e.target.offsetHeight + 200)) {\n      if (canGoNext && !goneNext) {\n        getUserList(true);\n      }\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(SearchDebouce, {\n    setSearch: setSearch,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"userList\",\n    onScroll: handleScroll,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }\n  }, fetching ? /*#__PURE__*/React.createElement(\"center\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Loader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 13\n    }\n  })) : users.length < 1 ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"noUser\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 11\n    }\n  }, \"You don't have any user to chat with.\") : users.map((item, i) => /*#__PURE__*/React.createElement(UserMain, {\n    key: i,\n    name: `${item.first_name || \"\"} ${item.last_name || \"\"}`,\n    profilePicture: item.profile_picture ? item.profile_picture.file_upload : \"\",\n    caption: item.caption,\n    count: item.message_count,\n    clickable: true,\n    onClick: () => setActiveUser(item),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 13\n    }\n  }))));\n}\n\nlet debouceTimeout;\n\nconst SearchDebouce = props => {\n  const [search, setSearch] = useState(\"\");\n  useEffect(() => {\n    clearTimeout(debouceTimeout);\n    debouceTimeout = setTimeout(() => {\n      props.setSearch(search);\n    }, 1000);\n  }, [search]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"searchCon\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: searchImg,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    placeholder: \"Search users\",\n    value: search,\n    onChange: e => setSearch(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 9\n    }\n  }));\n};\n\nexport default UsersList;","map":{"version":3,"sources":["/home/richeshgupta/Desktop/SecureBit/frontend/src/Pages/usersList.js"],"names":["React","useState","useEffect","useContext","searchImg","Loader","axiosHandler","getToken","LastUserChat","activeChatUserAction","triggerRefreshUserListAction","store","PROFILE_URL","UserMain","goneNext","UsersList","users","setUsers","fetching","setFetching","nextPage","setNextPage","canGoNext","setCanGoNext","search","setSearch","state","triggerRefreshUserList","dispatch","getUserList","type","payload","append","extra","_token","_users","method","url","token","catch","e","data","next","results","checkLastChat","lastUserChat","localStorage","getItem","JSON","parse","filter","item","id","length","setActiveUser","user_data","setItem","stringify","handleScroll","target","scrollTop","scrollHeight","offsetHeight","map","i","first_name","last_name","profile_picture","file_upload","caption","message_count","debouceTimeout","SearchDebouce","props","clearTimeout","setTimeout","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\nimport searchImg from \"../assets/search.png\";\nimport Loader from \"../components/loader\";\nimport { axiosHandler, getToken, LastUserChat } from \"../helper\";\nimport {activeChatUserAction, triggerRefreshUserListAction} from \"../stateManagement/actions\";\nimport { store } from \"../stateManagement/store\";\nimport { PROFILE_URL } from \"../urls\";\nimport { UserMain } from \"./homeComponents\";\n\nlet goneNext = false;\n\nfunction UsersList() {\n  const [users, setUsers] = useState([]);\n  const [fetching, setFetching] = useState(true);\n  const [nextPage, setNextPage] = useState(1);\n  const [canGoNext, setCanGoNext] = useState(false);\n  const [search, setSearch] = useState(\"\")\n\n  const { state:{triggerRefreshUserList}, dispatch } = useContext(store);\n\n  useEffect(() => {\n    getUserList();\n  }, [search]);\n\n  useEffect(() => {\n    if(triggerRefreshUserList){\n      getUserList()\n      dispatch({type: triggerRefreshUserListAction, payload: false})\n    }\n\n  }, [triggerRefreshUserList])\n\n  const getUserList = async (append=false) => {\n    let extra=\"\";\n    if(search !== \"\"){\n      extra += `&keyword=${search}`\n    }\n    setCanGoNext(false);\n    const _token = await getToken();\n    const _users = await axiosHandler({\n      method: \"get\",\n      url: PROFILE_URL + `?page=${nextPage}${extra}`,\n      token: _token,\n    }).catch((e) => null);\n    if (_users) {\n      if (_users.data.next) {\n        setNextPage(nextPage + 1);\n        setCanGoNext(true);\n      }\n      if(append){\n        setUsers([...users, ..._users.data.results]);\n        goneNext = false;\n      }\n      else{\n        setUsers(_users.data.results);\n      }\n      \n      setFetching(false);\n    }\n\n    checkLastChat(_users.data.results);\n  };\n\n  const checkLastChat = (users) => {\n    let lastUserChat = localStorage.getItem(LastUserChat)\n    if(lastUserChat){\n      lastUserChat = JSON.parse(lastUserChat);\n      if(users.filter(item => item.id === lastUserChat.id).length){\n        setActiveUser(lastUserChat)\n      }\n    }\n  }\n\n  const setActiveUser = (user_data) => {\n    localStorage.setItem(LastUserChat, JSON.stringify(user_data))\n    dispatch({ type: activeChatUserAction, payload: user_data });\n  };\n\n  const handleScroll = (e) => {\n    if(e.target.scrollTop >= (e.target.scrollHeight - (e.target.offsetHeight + 200))){\n      if(canGoNext && !goneNext){\n        getUserList(true)\n      }\n    }\n  }\n\n  return (\n    <div>\n      <SearchDebouce setSearch={setSearch} />\n      <div className=\"userList\" onScroll={handleScroll}>\n        {fetching ? (\n          <center>\n            <Loader />\n          </center>\n        ) : users.length < 1 ? (\n          <div className=\"noUser\">You don't have any user to chat with.</div>\n        ) : (\n          users.map((item, i) => (\n            <UserMain\n              key={i}\n              name={`${item.first_name || \"\"} ${item.last_name || \"\"}`}\n              profilePicture={item.profile_picture ? item.profile_picture.file_upload : \"\"}\n              caption={item.caption}\n              count={item.message_count}\n              clickable\n              onClick={() => setActiveUser(item)}\n            />\n          ))\n        )}\n      </div>\n    </div>\n  );\n}\n\nlet debouceTimeout;\n\nconst SearchDebouce = (props) => {\n  const [search, setSearch] = useState(\"\")\n\n  useEffect(() => {\n    clearTimeout(debouceTimeout);\n    debouceTimeout = setTimeout(() => {\n      props.setSearch(search)\n    }, 1000)\n  }, [search])\n\n  return (\n    <div className=\"searchCon\">\n        <img src={searchImg} />\n        <input placeholder=\"Search users\" value={search} onChange={e => setSearch(e.target.value)} />\n      </div>\n  )\n}\n\nexport default UsersList;\n"]},"metadata":{},"sourceType":"module"}